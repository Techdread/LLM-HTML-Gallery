<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Dyson Sphere Simulator</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #000;
        }

        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
        }

        #progress-bar {
            width: 200px;
        }

        #stats {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <div id="controls">
        <button id="toggleConstruction">Toggle Construction</button>
        <input type="range" id="progress-bar" min="0" max="100" value="0">
        <button id="toggleCollectors">Toggle Collectors</button>
        <input type="range" id="brightness-slider" min="0" max="1" step="0.1" value="1">
        <label for="brightness-slider">Star Brightness</label>
    </div>
    <div id="stats"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.165.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.165.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GUI } from 'three/addons/libs/dat.gui.module.min.js';

        let scene, camera, renderer, controls;
        let star, dysonSphere, collectors = [], collector, Geometry, collectorMaterial;
        let constructionProgress = 0; // Percentage
        let isConstructing = false;
        let starBrightness = 1;
        let statsVisible = true;

        init();
        animate();

        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // OrbitControls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.25;

            // Star
            const starGeometry = new THREE.SphereGeometry(1, 32, 32);
            const starMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff, opacity: starBrightness, transparent: true });
            star = new THREE.Mesh(starGeometry, starMaterial);
            scene.add(star);

            // Sunspots (simple representation)
            for (let i = 0; i < 10; i++) {
                const sunspot = new THREE.Mesh(
                    new THREE.SphereGeometry(0.05, 8, 8),
                    new THREE.MeshBasicMaterial({ color: 0x000000, opacity: 0.5, transparent: true })
                );
                sunspot.position.set(
                    Math.random() * 2 - 1,
                    Math.random() * 2 - 1,
                    Math.random() * 2 - 1
                ).normalize().multiplyScalar(0.9);
                star.add(sunspot);
            }

            // Corona (simple representation)
            const coronaGeometry = new THREE.SphereGeometry(1.1, 32, 32);
            const coronaMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff, opacity: 0.1, transparent: true, wireframe: true });
            const corona = new THREE.Mesh(coronaGeometry, coronaMaterial);
            star.add(corona);

            // Dyson Sphere (initialization)
            const radius = 3;
            collectorGeometry = new THREE.BoxGeometry(0.1, 0.1, 0.1); // Simple cubes for collectors
            collectorMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00, opacity: 0.5, transparent: true });
            dysonSphere = new THREE.Group();
            scene.add(dysonSphere);

            // Initialize some collectors
            for (let i = 0; i < 100; i++) {
                const collector = new THREE.Mesh(collectorGeometry, collectorMaterial);
                collector.position.set(
                    Math.random() * 2 - 1,
                    Math.random() * 2 - 1,
                    Math.random() * 2 - 1
                ).normalize().multiplyScalar(radius);
                collectors.push(collector);
                dysonSphere.add(collector);
            }

            // Controls
            document.getElementById('toggleConstruction').addEventListener('click', toggleConstruction);
            document.getElementById('progress-bar').addEventListener('input', updateProgress);
            document.getElementById('toggleCollectors').addEventListener('click', toggleCollectorVisibility);
            document.getElementById('brightness-slider').addEventListener('input', updateStarBrightness);

            // GUI for stats
            const gui = new GUI({ autoPlace: false });
            gui.domElement.style.position = 'absolute';
            gui.domElement.style.top = '60px';
            gui.domElement.style.left = '10px';
            document.body.appendChild(gui.domElement);
            const statsFolder = gui.addFolder('Statistics');
            statsFolder.add({ completion: 0 }, 'completion').listen();
            statsFolder.add({ collectorsBuilt: 0 }, 'collectorsBuilt').listen();
            statsFolder.open();

            // Initial update
            updateProgress({ target: { value: constructionProgress } }); // Simulate initial progress
            updateStarBrightness({ target: { value: starBrightness } }); // Initial brightness
        }

        function animate() {
            requestAnimationFrame(animate);

            // Update star's corona (simple pulsing effect)
            star.children[10].material.opacity = Math.sin(Date.now() * 0.001) * 0.5 + 0.5; // Adjust the index if sunspots are more than 10

            // Update construction progress if active
            if (isConstructing) {
                constructionProgress = Math.min(constructionProgress + 0.1, 100);
                document.getElementById('progress-bar').value = constructionProgress;
                updateProgress({ target: { value: constructionProgress } });
            }

            controls.update();
            renderer.render(scene, camera);
        }

        function toggleConstruction() {
            isConstructing = !isConstructing;
            document.getElementById('toggleConstruction').textContent = isConstructing ? 'Stop Construction' : 'Start Construction';
        }

        function updateProgress(event) {
            constructionProgress = parseFloat(event.target.value);
            const collectorsToShow = Math.floor(collectors.length * (constructionProgress / 100));
            collectors.forEach((collector, index) => {
                collector.visible = index < collectorsToShow;
            });
            // Update stats
            const stats = {
                completion: constructionProgress,
                collectorsBuilt: collectorsToShow
            };
            document.getElementById('stats').innerHTML = `
                <p>Completion: ${constructionProgress}%</p>
                <p>Collectors Built: ${collectorsToShow}</p>
            `;
        }

        function toggleCollectorVisibility() {
            collectors.forEach(collector => collector.visible = !collector.visible);
        }

        function updateStarBrightness(event) {
            starBrightness = parseFloat(event.target.value);
            star.material.opacity = starBrightness;
        }
    </script>
</body>

</html>